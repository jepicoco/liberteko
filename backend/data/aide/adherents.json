{
  "module": "adherents",
  "titre": "Gestion des Adhérents",
  "icone": "bi-people",
  "features": [
    {
      "id": "adherents_lister",
      "titre": "Lister les adhérents",
      "description": "Afficher la liste complète des adhérents avec filtres et pagination",
      "role_min": "benevole",
      "procedure": [
        "Accéder à 'Adhérents' dans le menu",
        "Utiliser les filtres : statut (actif/inactif/suspendu), rôle, membre association, recherche par nom/email",
        "Cliquer sur 'Afficher filtres' pour accéder aux options avancées",
        "La pagination permet de naviguer entre les pages (50 résultats par défaut)"
      ],
      "faq": [
        {
          "question": "Comment retrouver rapidement un adhérent ?",
          "reponse": "Utilisez la barre de recherche qui filtre par nom, prénom, email ou code-barre. La recherche est instantanée après 500ms de saisie."
        },
        {
          "question": "Que signifient les icônes dans la liste ?",
          "reponse": "L'icône bâtiment indique un membre de l'association. L'icône coeur indique un compte enfant rattaché à un parent."
        }
      ],
      "mots_cles": ["liste", "filtrer", "rechercher", "pagination", "adherents", "usagers"]
    },
    {
      "id": "adherents_creer",
      "titre": "Créer un adhérent",
      "description": "Ajouter un nouvel adhérent avec ses informations personnelles, coordonnées et statut d'adhésion",
      "role_min": "benevole",
      "procedure": [
        "Cliquer sur 'Nouvel usager'",
        "Onglet 'Informations personnelles' : renseigner nom*, prénom*, email*, mot de passe*, date de naissance, photo (URL)",
        "Onglet 'Coordonnées' : renseigner téléphone, adresse, code postal, ville",
        "Onglet 'Adhésion' : définir statut, rôle, modules autorisés (si agent/gestionnaire/comptable), membre association, dates d'adhésion",
        "Onglet 'Notes' : ajouter des notes internes (visibles uniquement par les gestionnaires)",
        "Cliquer sur 'Enregistrer'",
        "Un email de bienvenue est envoyé automatiquement si un événement UTILISATEUR_CREATION est configuré"
      ],
      "faq": [
        {
          "question": "Le mot de passe est-il obligatoire ?",
          "reponse": "Oui, le mot de passe est obligatoire à la création. Utilisez le bouton 'Générer' pour créer un mot de passe sécurisé. L'indicateur de force vous guide (minimum recommandé : niveau 2/4)."
        },
        {
          "question": "Qu'est-ce que 'Modules autorisés' ?",
          "reponse": "Pour les rôles agent, gestionnaire et comptable, vous pouvez restreindre l'accès à certains modules (ludothèque, bibliothèque, filmothèque, discothèque). Si aucun module n'est coché, l'utilisateur a accès à tous."
        }
      ],
      "mots_cles": ["créer", "nouveau", "ajouter", "usager", "adherent", "inscription", "mot de passe"]
    },
    {
      "id": "adherents_modifier",
      "titre": "Modifier un adhérent",
      "description": "Modifier les informations d'un adhérent existant",
      "role_min": "benevole",
      "procedure": [
        "Dans la liste des adhérents, cliquer sur le bouton 'Modifier' (icône crayon)",
        "Modifier les informations souhaitées dans les différents onglets",
        "Le mot de passe n'est pas obligatoire en modification (laisser vide pour ne pas changer)",
        "Cliquer sur 'Enregistrer'",
        "Un événement UTILISATEUR_MODIFICATION peut déclencher une notification"
      ],
      "faq": [
        {
          "question": "Comment réinitialiser le mot de passe d'un adhérent ?",
          "reponse": "En modification, saisissez un nouveau mot de passe dans le champ prévu. Vous pouvez utiliser le bouton 'Générer' pour créer un mot de passe sécurisé."
        },
        {
          "question": "Les modifications sont-elles journalisées ?",
          "reponse": "Oui, toutes les modifications sont enregistrées dans les logs système avec l'identité de l'utilisateur qui a effectué la modification."
        }
      ],
      "mots_cles": ["modifier", "éditer", "mettre à jour", "changement"]
    },
    {
      "id": "adherents_supprimer",
      "titre": "Supprimer/Archiver un adhérent",
      "description": "Archiver un adhérent (suppression RGPD-compliant avec conservation des données historiques)",
      "role_min": "gestionnaire",
      "procedure": [
        "Cliquer sur le bouton 'Supprimer' (icône poubelle) dans la liste",
        "Confirmer la suppression dans la boîte de dialogue",
        "Le système vérifie qu'il n'y a pas d'emprunts en cours",
        "L'adhérent est archivé dans la table UtilisateurArchive avec ses données complètes",
        "La date de dernière activité est calculée automatiquement",
        "Un log d'accès aux archives est créé pour traçabilité RGPD"
      ],
      "faq": [
        {
          "question": "Peut-on supprimer un adhérent avec des emprunts en cours ?",
          "reponse": "Non, le système bloque la suppression si l'adhérent a des emprunts 'en_cours' ou 'en_retard'. Il faut d'abord clôturer tous les emprunts."
        },
        {
          "question": "Les données sont-elles vraiment supprimées ?",
          "reponse": "Non, conformément au RGPD, les données sont archivées dans une table dédiée (UtilisateurArchive) avec traçabilité complète de l'archivage : qui, quand, pourquoi."
        }
      ],
      "mots_cles": ["supprimer", "archiver", "effacer", "RGPD", "données personnelles"]
    },
    {
      "id": "adherents_visualiser",
      "titre": "Visualiser les détails d'un adhérent",
      "description": "Afficher une vue complète des informations, statistiques, famille et historique d'un adhérent",
      "role_min": "benevole",
      "procedure": [
        "Cliquer sur le bouton 'Voir détails' (icône oeil) dans la liste",
        "La modal affiche 5 onglets :",
        "  - Infos : coordonnées, rôle, adhésion, notes",
        "  - Famille : parent/enfants rattachés, tarif famille",
        "  - Statistiques : emprunts total/en cours/en retard, cotisations",
        "  - Communications : historique emails et SMS envoyés",
        "  - Actions : raccourcis pour email, SMS, nouvelle cotisation, nouveau prêt"
      ],
      "faq": [
        {
          "question": "Comment envoyer un email depuis cette vue ?",
          "reponse": "Onglet 'Actions' puis 'Envoyer un email'. Vous pouvez choisir un template pré-configuré ou saisir manuellement l'objet et le message."
        }
      ],
      "mots_cles": ["voir", "détails", "fiche", "profil", "visualiser"]
    },
    {
      "id": "adherents_famille",
      "titre": "Gérer les familles",
      "description": "Lier des adhérents en famille (parent/tuteur - enfants) pour bénéficier de tarifs préférentiels",
      "role_min": "benevole",
      "procedure": [
        "Ouvrir la fiche détaillée d'un adhérent (parent)",
        "Aller dans l'onglet 'Famille'",
        "Cliquer sur 'Lier un membre'",
        "Rechercher l'adhérent à rattacher (nom, prénom, email)",
        "Sélectionner le type de lien : Parent, Tuteur légal, Autre responsable",
        "Confirmer la liaison",
        "Le tarif famille est automatiquement calculé si disponible"
      ],
      "faq": [
        {
          "question": "Un compte enfant peut-il avoir plusieurs parents ?",
          "reponse": "Non, un enfant ne peut être rattaché qu'à un seul parent/tuteur à la fois. Utilisez la fonction 'Transférer responsabilité' pour changer de parent."
        },
        {
          "question": "Comment fonctionne le tarif famille ?",
          "reponse": "Le système compare le coût individuel total (nombre de membres x tarif individuel) avec le tarif famille global. L'économie réalisée est affichée automatiquement."
        }
      ],
      "mots_cles": ["famille", "parent", "enfant", "tuteur", "lier", "rattacher", "tarif famille"]
    },
    {
      "id": "adherents_cotisations",
      "titre": "Gérer les cotisations",
      "description": "Créer, consulter et gérer les cotisations des adhérents",
      "role_min": "benevole",
      "procedure": [
        "Route : GET /api/cotisations?adherent_id=X",
        "Créer une cotisation : POST /api/cotisations",
        "  - Sélectionner l'adhérent (adherent_id ou utilisateur_id)",
        "  - Choisir le tarif de cotisation (tarif_cotisation_id)",
        "  - Dates optionnelles (calculées automatiquement selon le tarif)",
        "  - Mode de paiement et référence",
        "  - Code de réduction optionnel",
        "La cotisation met à jour automatiquement les dates d'adhésion de l'adhérent",
        "Un événement COTISATION_CONFIRMATION peut déclencher l'envoi d'un email/SMS"
      ],
      "faq": [
        {
          "question": "Comment fonctionne le calcul prorata ?",
          "reponse": "Si le tarif est de type 'prorata', le montant est calculé proportionnellement à la période restante entre la date de début et la fin de la période tarifaire."
        },
        {
          "question": "Peut-on annuler une cotisation ?",
          "reponse": "Oui, via POST /api/cotisations/:id/annuler avec un motif. Seules les cotisations annulées peuvent être supprimées (sécurité comptable)."
        }
      ],
      "mots_cles": ["cotisation", "adhésion", "paiement", "tarif", "prorata", "reçu"]
    },
    {
      "id": "adherents_communications",
      "titre": "Envoyer des communications",
      "description": "Envoyer des emails et SMS aux adhérents (manuel ou par template)",
      "role_min": "benevole",
      "procedure": [
        "Email : POST /api/adherents/:id/send-email",
        "  - Mode 'template' : sélectionner un template pré-configuré (variables automatiques)",
        "  - Mode 'manual' : saisir objet et corps du message",
        "  - Variables disponibles : {{prenom}}, {{nom}}, {{email}}, {{code_barre}}, etc.",
        "SMS : POST /api/adherents/:id/send-sms",
        "  - Maximum 160 caractères (3 segments = 480 max)",
        "  - Vérification du numéro de téléphone requis",
        "L'historique complet est enregistré dans EmailLog et SmsLog"
      ],
      "faq": [
        {
          "question": "Les emails utilisent-ils un serveur SMTP ?",
          "reponse": "Oui, via emailService.js avec chiffrement AES-256 des identifiants SMTP. Configuration dans ConfigurationEmail."
        },
        {
          "question": "Peut-on envoyer en masse ?",
          "reponse": "Oui, sélectionnez plusieurs adhérents dans la liste (cases à cocher) puis utilisez les boutons 'Envoyer email' ou 'Envoyer SMS' de la barre d'actions groupées."
        }
      ],
      "mots_cles": ["email", "SMS", "message", "communication", "template", "envoi groupé"]
    },
    {
      "id": "adherents_export",
      "titre": "Exporter les données",
      "description": "Exporter la liste des adhérents au format CSV",
      "role_min": "benevole",
      "procedure": [
        "Cliquer sur 'Exporter CSV' pour exporter tous les adhérents filtrés",
        "OU sélectionner des adhérents spécifiques puis 'Exporter sélection'",
        "Le fichier CSV contient : code-barre, nom, prénom, email, téléphone, rôle, statut, dates d'adhésion"
      ],
      "faq": [
        {
          "question": "Les exports respectent-ils les filtres actifs ?",
          "reponse": "Oui, 'Exporter CSV' exporte uniquement les adhérents correspondant aux filtres appliqués (statut, rôle, recherche)."
        },
        {
          "question": "Le mot de passe est-il exporté ?",
          "reponse": "Non, le mot de passe n'est jamais exporté ni visible dans l'interface (attribut exclu systématiquement)."
        }
      ],
      "mots_cles": ["export", "CSV", "télécharger", "exporter"]
    },
    {
      "id": "adherents_carte",
      "titre": "Imprimer la carte d'adhérent",
      "description": "Générer et imprimer une carte d'adhérent avec code-barre",
      "role_min": "benevole",
      "procedure": [
        "Cliquer sur le bouton 'Carte' (icône imprimante) dans la liste",
        "OU utiliser barcodesAPI.printAdherentCard(id)",
        "Le PDF est généré avec : photo, nom, prénom, code-barre, dates d'adhésion",
        "Impression directe ou téléchargement selon configuration"
      ],
      "faq": [
        {
          "question": "Le code-barre est-il généré automatiquement ?",
          "reponse": "Oui, à la création de l'adhérent, un code-barre unique est généré via codeBarreService.js (format EAN-13 ou personnalisé)."
        }
      ],
      "mots_cles": ["carte", "badge", "imprimer", "code-barre", "PDF"]
    },
    {
      "id": "adherents_roles",
      "titre": "Gérer les rôles et permissions",
      "description": "Définir le rôle et les modules autorisés pour un adhérent",
      "role_min": "gestionnaire",
      "procedure": [
        "Rôles disponibles (ordre hiérarchique) :",
        "  - usager : accès portail membre uniquement",
        "  - benevole : lecture/création dans les modules autorisés",
        "  - agent : idem bénévole + interface scan/accueil",
        "  - gestionnaire : gestion complète des modules autorisés",
        "  - comptable : accès comptabilité + modules autorisés",
        "  - administrateur : accès complet sans restriction",
        "Pour agent, gestionnaire, comptable : sélectionner les modules autorisés (ludothèque, bibliothèque, filmothèque, discothèque)",
        "Si aucun module sélectionné = accès à tous les modules"
      ],
      "faq": [
        {
          "question": "Un agent peut-il créer des adhérents ?",
          "reponse": "Oui, les rôles benevole, agent, gestionnaire et administrateur peuvent créer des adhérents."
        },
        {
          "question": "Les usagers ont-ils accès à l'interface admin ?",
          "reponse": "Non, les usagers n'ont accès qu'au portail membre (/usager) avec authentification séparée (usager_token)."
        }
      ],
      "mots_cles": ["rôle", "permissions", "modules", "accès", "droits", "sécurité"]
    },
    {
      "id": "adherents_recherche",
      "titre": "Rechercher un adhérent",
      "description": "Recherche rapide et filtres avancés pour retrouver un adhérent",
      "role_min": "benevole",
      "procedure": [
        "Recherche simple : saisir dans la barre de recherche (nom, prénom, email, code-barre)",
        "Recherche avec debounce de 500ms pour optimiser les performances",
        "Filtres combinables : statut + rôle + membre association + recherche textuelle",
        "Tri possible par : code-barre, nom, email, statut, date d'adhésion (clic sur en-tête de colonne)"
      ],
      "faq": [
        {
          "question": "La recherche est-elle sensible à la casse ?",
          "reponse": "Non, la recherche est insensible à la casse (Op.like avec %)."
        },
        {
          "question": "Combien de résultats par page ?",
          "reponse": "Par défaut 50 résultats par page, configurable via le paramètre limit (pagination.js)."
        }
      ],
      "mots_cles": ["rechercher", "trouver", "filtrer", "tri", "recherche"]
    },
    {
      "id": "adherents_import",
      "titre": "Importer des adhérents",
      "description": "Importer des adhérents depuis un fichier CSV ou une API externe",
      "role_min": "administrateur",
      "procedure": [
        "Préparation du fichier CSV : colonnes obligatoires (nom, prenom, email, password)",
        "Utiliser /api/import/adherents (POST multipart/form-data)",
        "Le système vérifie les doublons (email unique)",
        "Les erreurs d'import sont retournées ligne par ligne",
        "OU utiliser la recherche externe dans le formulaire de création pour pré-remplir un adhérent depuis une API"
      ],
      "faq": [
        {
          "question": "Quel encodage pour le CSV ?",
          "reponse": "UTF-8 de préférence. Le séparateur peut être virgule ou point-virgule."
        },
        {
          "question": "Les mots de passe sont-ils hashés automatiquement ?",
          "reponse": "Oui, le modèle Utilisateur utilise un beforeCreate hook pour hasher avec bcrypt (coût 10)."
        }
      ],
      "mots_cles": ["import", "CSV", "importer", "masse", "bulk"]
    }
  ]
}
