{
  "module": "utilisateurs_admin",
  "titre": "Gestion des Utilisateurs Admin",
  "icone": "bi-people",
  "description": "Module de gestion des comptes utilisateurs avec attribution de rôles et permissions hiérarchiques pour l'interface d'administration",
  "features": [
    {
      "id": "admin_connexion",
      "titre": "Connexion à l'interface admin",
      "description": "Authentification sécurisée pour accéder à l'interface d'administration avec JWT token (validité 24h) et rate limiting (5 tentatives/15min)",
      "role_min": "benevole",
      "procedure": [
        "Accéder à /admin/login.html",
        "Saisir l'email et le mot de passe",
        "Cliquer sur 'Se connecter'",
        "Le système vérifie les identifiants via POST /api/auth/login",
        "En cas de succès, un token JWT est généré et stocké dans localStorage",
        "Redirection automatique vers le dashboard",
        "Le token est envoyé dans l'en-tête Authorization: Bearer <token> pour chaque requête"
      ],
      "faq": [
        {
          "question": "Combien de temps dure une session de connexion ?",
          "reponse": "Le token JWT expire après 24 heures. Vous devrez vous reconnecter après ce délai."
        },
        {
          "question": "Que se passe-t-il après 5 tentatives échouées ?",
          "reponse": "Le système bloque temporairement l'accès pendant 15 minutes pour protéger contre les attaques par force brute."
        },
        {
          "question": "Le compte est suspendu ou inactif, que faire ?",
          "reponse": "Contacter un administrateur qui pourra réactiver le compte depuis Paramètres > Utilisateurs ou directement dans Usagers."
        }
      ],
      "mots_cles": ["connexion", "login", "authentification", "token", "jwt", "session"]
    },
    {
      "id": "admin_creer_compte",
      "titre": "Créer un nouveau compte utilisateur",
      "description": "Création d'un nouveau compte avec attribution d'un rôle et définition des permissions (usager, bénévole, agent, gestionnaire, comptable ou administrateur)",
      "role_min": "administrateur",
      "procedure": [
        "Accéder à Usagers via le menu principal",
        "Cliquer sur 'Créer un compte' ou 'Nouvel usager'",
        "Remplir le formulaire : nom, prénom, email, mot de passe (min 6 caractères), téléphone, adresse, etc.",
        "Sélectionner le rôle dans la liste déroulante (usager par défaut)",
        "Si le rôle est agent, benevole, gestionnaire ou comptable : cocher les modules autorisés (ludothèque, bibliothèque, filmothèque, discothèque) ou laisser vide pour accès à tous",
        "Le statut par défaut est 'actif'",
        "Cliquer sur 'Enregistrer'",
        "Le système crée l'utilisateur via POST /api/utilisateurs avec génération automatique d'un code-barre",
        "Un événement UTILISATEUR_CREATION est déclenché (email de bienvenue si configuré)"
      ],
      "faq": [
        {
          "question": "Quelle est la différence entre les rôles ?",
          "reponse": "Usager (niveau 0) : espace membre uniquement. Bénévole (1) : emprunts/retours. Agent (2) : comme bénévole avec permissions étendues. Gestionnaire (3) : gestion quotidienne complète. Comptable (4) : finances et exports. Administrateur (5) : accès total."
        },
        {
          "question": "Que signifie 'modules autorisés' ?",
          "reponse": "Pour les rôles agent, benevole, gestionnaire et comptable, vous pouvez restreindre l'accès à certains modules (ludothèque, bibliothèque, filmothèque, discothèque). Si aucun module n'est coché, l'utilisateur aura accès à tous. Les administrateurs ont toujours accès à tous les modules."
        },
        {
          "question": "Le code-barre est-il obligatoire ?",
          "reponse": "Non, un code-barre unique est généré automatiquement à la création via le service codeBarreService (format EAN-13 avec préfixe configurable)."
        }
      ],
      "mots_cles": ["créer", "compte", "utilisateur", "nouveau", "inscription", "rôle", "permissions"]
    },
    {
      "id": "admin_lister_utilisateurs",
      "titre": "Consulter la liste des utilisateurs",
      "description": "Visualisation de tous les comptes utilisateurs avec filtrage par rôle, statut et recherche textuelle",
      "role_min": "gestionnaire",
      "procedure": [
        "Accéder à Paramètres > Utilisateurs",
        "La liste affiche tous les utilisateurs ayant un rôle administratif (benevole, agent, gestionnaire, comptable, administrateur)",
        "Utiliser les filtres : rôle (dropdown), statut (actif/suspendu/inactif), recherche par nom/prénom/email",
        "Les statistiques en haut affichent le nombre total et par rôle",
        "Chaque ligne montre : avatar (initiales), nom, email, rôle (badge coloré), statut et actions disponibles"
      ],
      "faq": [
        {
          "question": "Pourquoi certains usagers n'apparaissent pas ?",
          "reponse": "Cette page affiche uniquement les utilisateurs avec un rôle administratif (pas les usagers simples). Pour voir tous les comptes, aller dans Usagers."
        },
        {
          "question": "Comment trouver rapidement un utilisateur ?",
          "reponse": "Utiliser le champ de recherche qui filtre par nom, prénom ou email en temps réel."
        }
      ],
      "mots_cles": ["liste", "utilisateurs", "consultation", "filtres", "recherche"]
    },
    {
      "id": "admin_modifier_role",
      "titre": "Modifier le rôle d'un utilisateur",
      "description": "Changement du rôle et des permissions d'un utilisateur existant (promotion ou rétrogradation dans la hiérarchie)",
      "role_min": "administrateur",
      "procedure": [
        "Accéder à Paramètres > Utilisateurs",
        "Cliquer sur l'icône crayon (modifier) à côté de l'utilisateur concerné",
        "Sélectionner le nouveau rôle dans la liste déroulante (usager, benevole, agent, gestionnaire, comptable, administrateur)",
        "Un avertissement s'affiche si : passage d'admin à non-admin (et dernier admin), passage à admin (accès complet), passage à usager (perte de droits admin)",
        "Cliquer sur 'Enregistrer'",
        "Le système met à jour le rôle via PUT /api/parametres/utilisateurs/:id/role",
        "L'utilisateur ne peut pas modifier son propre rôle"
      ],
      "faq": [
        {
          "question": "Puis-je rétrograder un administrateur ?",
          "reponse": "Oui, sauf si c'est le dernier administrateur du système. Le système empêche la rétrogradation du dernier admin pour éviter un blocage."
        },
        {
          "question": "L'utilisateur est-il notifié du changement de rôle ?",
          "reponse": "Actuellement, aucune notification automatique n'est envoyée. Il est recommandé d'informer l'utilisateur manuellement."
        },
        {
          "question": "Que se passe-t-il si je me retire les droits admin par erreur ?",
          "reponse": "Impossible, le système empêche un utilisateur de modifier son propre rôle."
        }
      ],
      "mots_cles": ["modifier", "rôle", "permissions", "promotion", "rétrogradation", "administrateur"]
    },
    {
      "id": "admin_promouvoir_usager",
      "titre": "Promouvoir un usager en staff",
      "description": "Transformation d'un compte usager simple en compte avec accès administratif (bénévole, agent, gestionnaire, comptable ou administrateur)",
      "role_min": "administrateur",
      "procedure": [
        "Accéder à Paramètres > Utilisateurs",
        "Cliquer sur 'Promouvoir un usager'",
        "Rechercher l'usager par nom, prénom ou email (minimum 2 caractères)",
        "Sélectionner l'usager dans les résultats (seuls les usagers sans rôle admin sont affichés)",
        "Choisir le rôle à attribuer (benevole, agent, gestionnaire, comptable ou administrateur selon vos permissions)",
        "Cliquer sur 'Promouvoir'",
        "Le système met à jour le rôle via PUT /api/parametres/utilisateurs/:id/role",
        "L'usager apparaît maintenant dans la liste des utilisateurs administratifs"
      ],
      "faq": [
        {
          "question": "Quelle est la différence entre 'Créer un compte' et 'Promouvoir un usager' ?",
          "reponse": "'Créer un compte' ajoute un nouvel utilisateur. 'Promouvoir un usager' transforme un compte usager existant en compte avec droits administratifs."
        },
        {
          "question": "Puis-je promouvoir n'importe quel usager à n'importe quel niveau ?",
          "reponse": "Seuls les administrateurs peuvent promouvoir. Vous pouvez attribuer des rôles jusqu'à votre propre niveau (un admin peut tout faire)."
        }
      ],
      "mots_cles": ["promouvoir", "usager", "staff", "bénévole", "gestionnaire", "attribution"]
    },
    {
      "id": "admin_reset_password",
      "titre": "Réinitialiser le mot de passe d'un utilisateur",
      "description": "Génération d'un nouveau mot de passe temporaire et envoi par email pour un utilisateur ayant perdu l'accès à son compte",
      "role_min": "administrateur",
      "procedure": [
        "Accéder à Paramètres > Utilisateurs",
        "Cliquer sur l'icône clé (réinitialiser mot de passe) à côté de l'utilisateur concerné",
        "Confirmer l'action dans le modal",
        "Le système génère un mot de passe temporaire aléatoire (16 caractères hexadécimaux)",
        "Le mot de passe est hashé et sauvegardé via PUT /api/parametres/utilisateurs/:id/reset-password",
        "Un email est envoyé à l'utilisateur avec le mot de passe temporaire et un lien vers la page de connexion",
        "L'utilisateur doit se connecter avec ce mot de passe et le changer immédiatement",
        "En cas d'échec d'envoi email, le mot de passe temporaire est affiché à l'admin"
      ],
      "faq": [
        {
          "question": "Puis-je réinitialiser le mot de passe d'un administrateur ?",
          "reponse": "Non, pour des raisons de sécurité, les administrateurs ne peuvent pas réinitialiser le mot de passe d'autres administrateurs."
        },
        {
          "question": "L'email n'a pas été reçu, que faire ?",
          "reponse": "Vérifier les spams. Si l'envoi a échoué, le système affiche le mot de passe temporaire à l'admin qui peut le communiquer directement à l'utilisateur."
        },
        {
          "question": "Le mot de passe temporaire expire-t-il ?",
          "reponse": "Non, il reste valide jusqu'à ce que l'utilisateur le change. Il est recommandé de le changer dès la première connexion."
        }
      ],
      "mots_cles": ["réinitialiser", "mot de passe", "password", "reset", "oublié", "email"]
    },
    {
      "id": "admin_gerer_modules_autorises",
      "titre": "Gérer les modules autorisés d'un utilisateur",
      "description": "Restriction de l'accès aux modules (ludothèque, bibliothèque, filmothèque, discothèque) pour les rôles non-administrateurs",
      "role_min": "administrateur",
      "procedure": [
        "Accéder à Usagers et modifier un utilisateur avec rôle agent, benevole, gestionnaire ou comptable",
        "Dans l'onglet 'Informations générales', section 'Rôle et permissions'",
        "Sélectionner le rôle (si agent, benevole, gestionnaire ou comptable, la section modules apparaît)",
        "Cocher les modules auxquels l'utilisateur aura accès (ludothèque, bibliothèque, filmothèque, discothèque)",
        "Si aucun module n'est coché : accès à tous les modules (comportement permissif)",
        "Si au moins un module est coché : accès restreint aux modules sélectionnés uniquement",
        "Enregistrer les modifications via PUT /api/utilisateurs/:id",
        "Les modules autorisés sont stockés dans le champ modules_autorises (JSON array ou null)"
      ],
      "faq": [
        {
          "question": "Les administrateurs peuvent-ils avoir des restrictions de modules ?",
          "reponse": "Non, les administrateurs ont toujours accès à tous les modules, quelle que soit la configuration."
        },
        {
          "question": "Que signifie 'aucun module coché' ?",
          "reponse": "C'est un comportement permissif : l'utilisateur aura accès à tous les modules. Pour restreindre, cocher explicitement les modules autorisés."
        },
        {
          "question": "Comment fonctionne le filtrage dans l'interface ?",
          "reponse": "Les menus et pages liés aux modules non autorisés sont masqués automatiquement. Le middleware checkModuleAccess bloque également les requêtes API non autorisées."
        }
      ],
      "mots_cles": ["modules", "permissions", "restrictions", "ludothèque", "bibliothèque", "filmothèque", "discothèque"]
    },
    {
      "id": "admin_suspendre_utilisateur",
      "titre": "Suspendre ou désactiver un compte utilisateur",
      "description": "Blocage temporaire ou permanent de l'accès d'un utilisateur sans supprimer son compte",
      "role_min": "administrateur",
      "procedure": [
        "Accéder à Usagers et rechercher l'utilisateur",
        "Cliquer sur 'Modifier'",
        "Changer le statut de 'actif' à 'suspendu' (blocage temporaire) ou 'inactif' (désactivation)",
        "Enregistrer via PUT /api/utilisateurs/:id",
        "Si le statut passe à 'suspendu', un événement UTILISATEUR_SUSPENDED est déclenché (notification possible)",
        "L'utilisateur ne pourra plus se connecter : le système retourne une erreur 403 'Account suspended' ou 'Account inactive'"
      ],
      "faq": [
        {
          "question": "Quelle est la différence entre 'suspendu' et 'inactif' ?",
          "reponse": "Suspendu = blocage temporaire (comportement impayé, etc.). Inactif = désactivation (compte dormant, plus membre). Les deux empêchent la connexion."
        },
        {
          "question": "Comment réactiver un compte suspendu ?",
          "reponse": "Modifier le statut de 'suspendu' ou 'inactif' à 'actif' dans la fiche usager."
        },
        {
          "question": "L'utilisateur peut-il toujours emprunter si son compte est suspendu ?",
          "reponse": "Non, un compte suspendu ou inactif ne peut pas se connecter ni effectuer d'opérations."
        }
      ],
      "mots_cles": ["suspendre", "désactiver", "bloquer", "statut", "inactif", "suspendu"]
    },
    {
      "id": "admin_archiver_utilisateur",
      "titre": "Archiver un compte utilisateur",
      "description": "Suppression conforme RGPD avec archivage des données dans une table dédiée (UtilisateurArchive) et journalisation des accès",
      "role_min": "administrateur",
      "procedure": [
        "Accéder à Usagers et rechercher l'utilisateur",
        "Cliquer sur 'Supprimer' (icône poubelle)",
        "Le système vérifie qu'il n'y a aucun emprunt en cours ou en retard",
        "Si des emprunts actifs existent, l'archivage est bloqué avec message d'erreur",
        "Saisir un motif d'archivage (optionnel) : 'Déménagement', 'Démission', 'Inactivité', etc.",
        "Confirmer l'archivage",
        "Le système récupère la date de dernière activité (dernier emprunt ou dernière cotisation)",
        "Toutes les données sont copiées dans la table utilisateurs_archives",
        "L'utilisateur est supprimé de la table principale",
        "Un log d'accès est créé dans archive_access_logs (qui, quand, pourquoi)",
        "L'opération s'effectue via DELETE /api/utilisateurs/:id avec transaction (rollback si erreur)"
      ],
      "faq": [
        {
          "question": "Puis-je archiver un utilisateur avec des emprunts en cours ?",
          "reponse": "Non, vous devez d'abord clôturer tous les emprunts (statut 'rendu' ou 'perdu')."
        },
        {
          "question": "Les données archivées sont-elles définitivement supprimées ?",
          "reponse": "Non, elles sont conservées dans la table utilisateurs_archives pour conformité légale et historique. Un accès restreint est disponible dans Paramètres > Archives."
        },
        {
          "question": "Puis-je restaurer un utilisateur archivé ?",
          "reponse": "Oui, depuis Paramètres > Archives, vous pouvez visualiser et restaurer un utilisateur archivé dans la table principale."
        }
      ],
      "mots_cles": ["archiver", "supprimer", "RGPD", "données", "archive", "historique"]
    },
    {
      "id": "admin_consulter_roles",
      "titre": "Consulter les rôles et permissions",
      "description": "Visualisation de la hiérarchie des rôles avec description des permissions et niveaux d'accès",
      "role_min": "benevole",
      "procedure": [
        "Accéder à Paramètres > Utilisateurs",
        "La section 'Rôles et permissions' affiche les 5 rôles disponibles sous forme de cartes colorées",
        "Chaque carte indique : le badge de rôle, une description courte et la liste des permissions principales",
        "L'API GET /api/parametres/roles retourne la liste complète avec niveaux (0 à 5)"
      ],
      "faq": [
        {
          "question": "Comment fonctionne la hiérarchie des rôles ?",
          "reponse": "Usager (0) < Bénévole (1) < Agent (2) < Gestionnaire (3) < Comptable (4) < Administrateur (5). Un rôle supérieur hérite des permissions des rôles inférieurs (sauf comptable qui a un accès spécialisé)."
        },
        {
          "question": "Le rôle 'agent' est-il différent de 'bénévole' ?",
          "reponse": "Oui, agent (niveau 2) a plus de permissions que bénévole (niveau 1), notamment pour la gestion avancée des emprunts et certains paramètres."
        }
      ],
      "mots_cles": ["rôles", "permissions", "hiérarchie", "niveaux", "droits", "accès"]
    }
  ],
  "roles_disponibles": [
    {
      "code": "usager",
      "libelle": "Usager",
      "niveau": 0,
      "description": "Accès consultation uniquement (profil et emprunts personnels)"
    },
    {
      "code": "benevole",
      "libelle": "Bénévole",
      "niveau": 1,
      "description": "Gestion des emprunts/retours, consultation des adhérents et articles"
    },
    {
      "code": "agent",
      "libelle": "Agent",
      "niveau": 2,
      "description": "Comme bénévole avec permissions étendues"
    },
    {
      "code": "gestionnaire",
      "libelle": "Gestionnaire",
      "niveau": 3,
      "description": "Gestion complète des adhérents, articles, emprunts et cotisations"
    },
    {
      "code": "comptable",
      "libelle": "Comptable",
      "niveau": 4,
      "description": "Accès comptabilité, cotisations et exports (accès spécialisé)"
    },
    {
      "code": "administrateur",
      "libelle": "Administrateur",
      "niveau": 5,
      "description": "Accès total à toutes les fonctionnalités"
    }
  ]
}
